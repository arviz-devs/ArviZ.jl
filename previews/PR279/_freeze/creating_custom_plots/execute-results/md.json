{
  "hash": "ad556b8e1e19572058f9d2b36277720c",
  "result": {
    "engine": "julia",
    "markdown": "---\ntitle: \"Creating custom plots\"\n---\n\nWhile ArviZ includes many plotting functions for visualizing the data stored in [`InferenceData`](@ref) objects, you will often need to construct custom plots, or you may want to tweak some of our plots in your favorite plotting package.\n\nIn this tutorial, we will show you a few useful techniques you can use to construct these plots using Julia's plotting packages.\nFor demonstration purposes, we'll use Makie.jl and AlgebraOfGraphics.jl, which can consume [`Dataset`](@ref) objects since they implement the Tables interface.\nHowever, we could just as easily have used StatsPlots.jl.\n\n\n\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nusing ArviZ, ArviZExampleData, DimensionalData, DataFrames, Statistics, AlgebraOfGraphics, CairoMakie\nusing AlgebraOfGraphics: density\nset_aog_theme!()\n```\n:::\n\n\n\nWe'll start by loading some draws from an implementation of the non-centered parameterization of the 8 schools model.\nIn this parameterization, the model has some sampling issues.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nidata = load_example_data(\"centered_eight\")\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>InferenceData<details>\n<summary>posterior</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">8</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├─────────────────┴───────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#ff875f\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 3]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#5fd7ff\">↗ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#5fd7ff\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>\n<span class=\"sgr90\">├───────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :mu   </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :theta</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#5fd7ff\">school</span>, <span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#5fd7ff\">8</span>×<span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :tau  </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr90\">├─────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 6 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:33.071271+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;sampling_time&quot; =&gt; 3.15909\n  &quot;tuning_steps&quot; =&gt; 1000\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>posterior_predictive</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">4</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├─────────────────┴────────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#5fd7ff\">↗ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#5fd7ff\">[0, …, 3]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :obs</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">4</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:33.992006+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>log_likelihood</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">4</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├─────────────────┴────────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#5fd7ff\">↗ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#5fd7ff\">[0, …, 3]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :obs</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">4</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:33.869112+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>sample_stats</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├───────────────┴──────────────────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#ff875f\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 3]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :step_size            </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :reached_max_treedepth</span><span class=\"sgr90\"> eltype: </span>Bool<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :perf_counter_start   </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :energy_error         </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :perf_counter_diff    </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :tree_depth           </span><span class=\"sgr90\"> eltype: </span>Int64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :process_time_diff    </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :n_steps              </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :max_energy_error     </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :step_size_bar        </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :lp                   </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :index_in_trajectory  </span><span class=\"sgr90\"> eltype: </span>Int64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :acceptance_rate      </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :smallest_eigval      </span><span class=\"sgr90\"> eltype: </span>Union{Missing, Float64}<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :energy               </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :diverging            </span><span class=\"sgr90\"> eltype: </span>Bool<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :largest_eigval       </span><span class=\"sgr90\"> eltype: </span>Union{Missing, Float64}<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">draw</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">500</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">4</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 6 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:33.083969+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;sampling_time&quot; =&gt; 3.15909\n  &quot;tuning_steps&quot; =&gt; 1000\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>prior</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├─────────────────┴────────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#5fd7ff\">↗ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#5fd7ff\">[0]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :theta</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :tau  </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :mu   </span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:29.212688+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>prior_predictive</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span> Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├─────────────────┴────────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>,\n  <span class=\"sgr38_5\" style=\"color:#0087d7\">→ draw</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#0087d7\">[0, …, 499]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>,\n  <span class=\"sgr38_5\" style=\"color:#5fd7ff\">↗ chain</span> Sampled{Int64} <span class=\"sgr38_5\" style=\"color:#5fd7ff\">[0]</span> <span class=\"sgr38_5\" style=\"color:#808080\">ForwardOrdered</span> <span class=\"sgr38_5\" style=\"color:#808080\">Irregular</span> <span class=\"sgr38_5\" style=\"color:#808080\">Points</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :obs</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span>, <span class=\"sgr38_5\" style=\"color:#0087d7\">draw</span>, <span class=\"sgr38_5\" style=\"color:#5fd7ff\">chain</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>×<span class=\"sgr38_5\" style=\"color:#0087d7\">500</span>×<span class=\"sgr38_5\" style=\"color:#5fd7ff\">1</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:29.215699+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>observed_data</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8-element </span>Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├───────────────────┴──────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :obs</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:29.216855+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n<details>\n<summary>constant_data</summary>\n<pre><span class=\"sgr90\">┌ </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8-element </span>Dataset<span class=\"sgr90\"> ┐</span>\n<span class=\"sgr90\">├───────────────────┴──────────────────────────────────────────── dims ┐</span>\n  <span class=\"sgr38_5\" style=\"color:#ff875f\">↓ school</span> Categorical{String} <span class=\"sgr38_5\" style=\"color:#ff875f\">[&quot;Choate&quot;, …, &quot;Mt. Hermon&quot;]</span> <span class=\"sgr38_5\" style=\"color:#808080\">Unordered</span>\n<span class=\"sgr90\">├────────────────────────────────────────────────────────────── layers ┤</span>\n<span class=\"sgr38_5\" style=\"color:#00afaf\">  :sigma</span><span class=\"sgr90\"> eltype: </span>Float64<span class=\"sgr90\"> dims: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">school</span><span class=\"sgr90\"> size: </span><span class=\"sgr38_5\" style=\"color:#ff875f\">8</span>\n<span class=\"sgr90\">├──────────────────────────────────────────────────────────── metadata ┤</span>\n  Dict{String, Any} with 4 entries:\n  &quot;created_at&quot; =&gt; &quot;2025-01-19T14:32:29.217914+00:00&quot;\n  &quot;inference_library_version&quot; =&gt; &quot;5.20.0&quot;\n  &quot;arviz_version&quot; =&gt; &quot;0.20.0&quot;\n  &quot;inference_library&quot; =&gt; &quot;pymc&quot;\n</pre></details>\n</div>\n```\n:::\n:::\n\n\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nidata.posterior\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\n┌ 500×4×8 Dataset ┐\n├─────────────────┴───────────────────────────────────────────── dims ┐\n  ↓ draw Sampled{Int64} [0, …, 499] ForwardOrdered Irregular Points,\n  → chain Sampled{Int64} [0, …, 3] ForwardOrdered Irregular Points,\n  ↗ school Categorical{String} [\"Choate\", …, \"Mt. Hermon\"] Unordered\n├───────────────────────────────────────────────────────────── layers ┤\n  :mu    eltype: Float64 dims: draw, chain size: 500×4\n  :theta eltype: Float64 dims: school, draw, chain size: 8×500×4\n  :tau   eltype: Float64 dims: draw, chain size: 500×4\n├─────────────────────────────────────────────────────────── metadata ┤\n  Dict{String, Any} with 6 entries:\n  \"created_at\"                => \"2025-01-19T14:32:33.071271+00:00\"\n  \"inference_library_version\" => \"5.20.0\"\n  \"sampling_time\"             => 3.15909\n  \"tuning_steps\"              => 1000\n  \"arviz_version\"             => \"0.20.0\"\n  \"inference_library\"         => \"pymc\"\n```\n:::\n:::\n\n\n\nThe plotting functions we'll be using interact with a tabular view of a `Dataset`.\nLet's see what that view looks like for a `Dataset`:\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndf = DataFrame(idata.posterior)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div><div style = \"float: left;\"><span>16000×6 DataFrame</span></div><div style = \"float: right;\"><span style = \"font-style: italic;\">15975 rows omitted</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">draw</th><th style = \"text-align: left;\">chain</th><th style = \"text-align: left;\">school</th><th style = \"text-align: left;\">mu</th><th style = \"text-align: left;\">theta</th><th style = \"text-align: left;\">tau</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: right;\">0</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.71572</td><td style = \"text-align: right;\">2.31739</td><td style = \"text-align: right;\">0.877494</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: right;\">1</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.90348</td><td style = \"text-align: right;\">0.88917</td><td style = \"text-align: right;\">0.802714</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.90348</td><td style = \"text-align: right;\">0.88917</td><td style = \"text-align: right;\">0.802714</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: right;\">3</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.90348</td><td style = \"text-align: right;\">0.88917</td><td style = \"text-align: right;\">0.802714</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: right;\">4</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">2.0175</td><td style = \"text-align: right;\">1.10912</td><td style = \"text-align: right;\">0.767934</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: right;\">5</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.67462</td><td style = \"text-align: right;\">2.11367</td><td style = \"text-align: right;\">0.844587</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: right;\">6</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">2.16297</td><td style = \"text-align: right;\">3.22908</td><td style = \"text-align: right;\">1.62637</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: right;\">7</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">2.73336</td><td style = \"text-align: right;\">2.37819</td><td style = \"text-align: right;\">2.41535</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: right;\">8</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">0.635038</td><td style = \"text-align: right;\">2.56258</td><td style = \"text-align: right;\">3.57007</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: right;\">9</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">0.550432</td><td style = \"text-align: right;\">-2.42224</td><td style = \"text-align: right;\">2.11321</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: right;\">10</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">0.937043</td><td style = \"text-align: right;\">5.89956</td><td style = \"text-align: right;\">2.8398</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: right;\">11</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">0.495742</td><td style = \"text-align: right;\">-3.29918</td><td style = \"text-align: right;\">2.29994</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: right;\">12</td><td style = \"text-align: right;\">0</td><td style = \"text-align: left;\">Choate</td><td style = \"text-align: right;\">1.699</td><td style = \"text-align: right;\">3.72623</td><td style = \"text-align: right;\">3.01604</td></tr><tr><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15989</td><td style = \"text-align: right;\">488</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">8.11775</td><td style = \"text-align: right;\">9.19908</td><td style = \"text-align: right;\">1.66423</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15990</td><td style = \"text-align: right;\">489</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">7.2898</td><td style = \"text-align: right;\">9.9798</td><td style = \"text-align: right;\">1.47038</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15991</td><td style = \"text-align: right;\">490</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">9.06658</td><td style = \"text-align: right;\">5.81672</td><td style = \"text-align: right;\">2.47537</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15992</td><td style = \"text-align: right;\">491</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">7.50137</td><td style = \"text-align: right;\">9.77055</td><td style = \"text-align: right;\">2.43626</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15993</td><td style = \"text-align: right;\">492</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">8.09751</td><td style = \"text-align: right;\">12.6073</td><td style = \"text-align: right;\">2.61785</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15994</td><td style = \"text-align: right;\">493</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">6.47077</td><td style = \"text-align: right;\">6.17633</td><td style = \"text-align: right;\">2.80606</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15995</td><td style = \"text-align: right;\">494</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">7.93618</td><td style = \"text-align: right;\">7.93811</td><td style = \"text-align: right;\">2.13744</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15996</td><td style = \"text-align: right;\">495</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">7.75062</td><td style = \"text-align: right;\">7.94832</td><td style = \"text-align: right;\">3.02048</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15997</td><td style = \"text-align: right;\">496</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">6.92237</td><td style = \"text-align: right;\">5.27502</td><td style = \"text-align: right;\">2.70464</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15998</td><td style = \"text-align: right;\">497</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">5.40884</td><td style = \"text-align: right;\">4.91466</td><td style = \"text-align: right;\">2.23649</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15999</td><td style = \"text-align: right;\">498</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">7.72144</td><td style = \"text-align: right;\">9.75447</td><td style = \"text-align: right;\">2.98966</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">16000</td><td style = \"text-align: right;\">499</td><td style = \"text-align: right;\">3</td><td style = \"text-align: left;\">Mt. Hermon</td><td style = \"text-align: right;\">10.2372</td><td style = \"text-align: right;\">14.0231</td><td style = \"text-align: right;\">3.05156</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n\nThe tabular view includes dimensions and variables as columns.\n\nWhen variables with different dimensions are flattened into a tabular form, there's always some duplication of values.\nAs a simple case, note that `chain`, `draw`, and `school` all have repeated values in the above table.\n\nIn this case, `theta` has the `school` dimension, but `tau` doesn't, so the values of `tau` will be repeated in the table for each value of `school`.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndf[df.school .== Ref(\"Choate\"), :].tau == df[df.school .== Ref(\"Deerfield\"), :].tau\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n```\ntrue\n```\n:::\n:::\n\n\n\nIn our first example, this will be important.\n\nHere, let's construct a trace plot.\nBesides `idata`, all functions and types in the following cell are defined in AlgebraOfGraphics or Makie:\n- `data(...)` indicates that the wrapped object implements the Tables interface\n- `mapping` indicates how the data should be used. The symbols are all column names in the table, which for us are our variable names and dimensions.\n- `visual` specifies how the data should be converted to a plot.\n- `Lines` is a plot type defined in Makie.\n- `draw` takes this combination and plots it.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(idata.posterior.mu) *\n    mapping(:draw, :mu; color=:chain => nonnumeric) *\n    visual(Lines; alpha=0.8),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-8-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nNote the line `idata.posterior.mu`.\nIf we had just used `idata.posterior`, the plot would have looked more-or-less the same, but there would be artifacts due to `mu` being copied many times.\nBy selecting `mu` directly, all other dimensions are discarded, so each value of `mu` appears in the plot exactly once.\n\nWhen examining an MCMC trace plot, we want to see a \"fuzzy caterpillar\".\nInstead we see a few places where the Markov chains froze.\nWe can do the same for `theta` as well, but it's more useful here to separate these draws by `school`.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(idata.posterior) *\n    mapping(:draw, :theta; layout=:school, color=:chain => nonnumeric) *\n    visual(Lines; alpha=0.8),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-9-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nSuppose we want to compare `tau` with `theta` for two different schools.\nTo do so, we use `InferenceData`s indexing syntax to subset the data.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(idata[:posterior, school=At([\"Choate\", \"Deerfield\"])]) *\n    mapping(:theta, :tau; color=:school) *\n    density() *\n    visual(Contour; levels=10),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-10-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nWe can also compare the density plots constructed from each chain for different schools.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(idata.posterior) *\n    mapping(:theta; layout=:school, color=:chain => nonnumeric) *\n    density(),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-11-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nIf we want to compare many schools in a single plot, an ECDF plot is more convenient.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(idata.posterior) * mapping(:theta; color=:school => nonnumeric) * visual(ECDFPlot);\n    axis=(; ylabel=\"probability\"),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-12-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nSo far we've just plotted data from one group, but we often want to combine data from multiple groups in one plot.\nThe simplest way to do this is to create the plot out of multiple layers.\nHere we use this approach to plot the observations over the posterior predictive distribution.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    (data(idata.posterior_predictive) * mapping(:obs; layout=:school) * density()) +\n    (data(idata.observed_data) * mapping(:obs, :obs => zero => \"\"; layout=:school)),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-13-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nAnother option is to combine the groups into a single dataset.\n\nHere we compare the prior and posterior.\nSince the prior has 1 chain and the posterior has 4 chains, if we were to combine them into a table, the structure would need to be ragged.\nThis is not currently supported.\n\nWe can then either plot the two distributions separately as we did before, or we can compare a single chain from each group.\nThis is what we'll do here.\nTo concatenate the two groups, we introduce a new named dimension using `DimensionalData.Dim`.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(\n        cat(\n            idata.posterior[chain=[1]], idata.prior; dims=Dim{:group}([:posterior, :prior])\n        )[:mu],\n    ) *\n    mapping(:mu; color=:group) *\n    histogram(; bins=20) *\n    visual(; alpha=0.8);\n    axis=(; ylabel=\"probability\"),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-14-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nFrom the trace plots, we suspected the geometry of this posterior was bad.\nLet's highlight divergent transitions.\nTo do so, we merge `posterior` and `samplestats`, which can do with `merge` since they share no common variable names.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ndraw(\n    data(merge(idata.posterior, idata.sample_stats)) * mapping(\n        :theta,\n        :tau;\n        layout=:school,\n        color=:diverging,\n        markersize=:diverging => (d -> d ? 5 : 2),\n    ),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-15-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\nWhen we try building more complex plots, we may need to build new `Dataset`s from our existing ones.\n\nOne example of this is the corner plot.\nTo build this plot, we need to make a copy of `theta` with a copy of the `school` dimension.\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\ntheta = idata.posterior.theta[school=1:4]\ntheta2 = rebuild(set(theta; school=:school2); name=:theta2)\nplot_data = Dataset(theta, theta2, idata.sample_stats.diverging)\ndraw(\n    data(plot_data) * mapping(\n        :theta,\n        :theta2 => \"theta\";\n        col=:school,\n        row=:school2,\n        color=:diverging,\n        markersize=:diverging => (d -> d ? 3 : 1),\n    );\n    figure=(; figsize=(5, 5)),\n    axis=(; aspect=1),\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=1}\n![](creating_custom_plots_files/figure-commonmark/cell-16-output-1.png){width=600 height=450}\n:::\n:::\n\n\n\n## Environment\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nusing Pkg\nPkg.status()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStatus `~/work/ArviZ.jl/ArviZ.jl/docs/Project.toml`\n⌃ [cbdf2221] AlgebraOfGraphics v0.11.4\n  [131c737c] ArviZ v0.12.3 `~/work/ArviZ.jl/ArviZ.jl`\n  [2f96bb34] ArviZExampleData v0.2.0\n  [4a6e88f0] ArviZPythonPlots v0.1.9\n  [13f3f980] CairoMakie v0.15.6\n  [a93c6f00] DataFrames v1.7.0\n  [0703355e] DimensionalData v0.29.23\n  [31c24e10] Distributions v0.25.120\n  [e30172f5] Documenter v1.14.1\n  [f6006082] EvoTrees v0.17.4\n  [b5cf5a8d] InferenceObjects v0.4.12\n  [be115224] MCMCDiagnosticTools v0.3.15\n  [a7f614a8] MLJBase v1.8.2\n  [614be32b] MLJIteration v0.6.3\n  [ce719bf2] PSIS v0.9.8\n  [7f36be82] PosteriorStats v0.2.8\n  [c1514b29] StanSample v7.10.2\n  [a19d573c] StatisticalMeasures v0.2.1\n  [10745b16] Statistics v1.11.1\n  [2913bbd2] StatsBase v0.34.6\n  [fce5fe82] Turing v0.40.2\n  [f43a241f] Downloads v1.6.0\n  [37e2e46d] LinearAlgebra v1.11.0\nInfo Packages marked with ⌃ have new versions available and may be upgradable.\n```\n:::\n:::\n\n\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nversioninfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nJulia Version 1.11.6\nCommit 9615af0f269 (2025-07-09 12:58 UTC)\nBuild Info:\n  Official https://julialang.org/ release\nPlatform Info:\n  OS: Linux (x86_64-linux-gnu)\n  CPU: 4 × AMD EPYC 7763 64-Core Processor\n  WORD_SIZE: 64\n  LLVM: libLLVM-16.0.6 (ORCJIT, znver3)\nThreads: 2 default, 0 interactive, 1 GC (on 4 virtual cores)\nEnvironment:\n  JULIA_PKG_SERVER_REGISTRY_PREFERENCE = eager\n  JULIA_PROJECT = @.\n  JULIA_NUM_THREADS = 2\n  JULIA_LOAD_PATH = @:@stdlib\n```\n:::\n:::\n\n\n\n",
    "supporting": [
      "creating_custom_plots_files"
    ],
    "filters": []
  }
}